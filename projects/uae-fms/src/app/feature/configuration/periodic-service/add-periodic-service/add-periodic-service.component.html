<form [formGroup]="periodicServiceForm">
  <div class="button-container">
    <button class="btn-primary-medium btn-scondary-green" type="button" (click)="showCancelAlert()">{{ 'forms.cancel' |
      translate }}</button>
    <button class="btn-primary-medium add" (click)="submit()">{{ (isEdit ? 'forms.edit' : 'forms.add') | translate
      }}</button>
  </div>

  <div class="form-section form-section--inline mt-3">
    <div class="row">
      <div class="col-12 col-md-3">
        <h3 class="form-section__title">{{
          'configuration.periodic_service.periodic_service_info' | translate }}</h3>
      </div>
      <div class="col-12 col-md-6 p-field form-section__field">
        <span class="p-float-label">
          <input formControlName="name" pInputText placeholder="{{
            'configuration.periodic_service.periodic_service_name' | translate
            }} *" required type="text">
          <label>{{ 'configuration.periodic_service.periodic_service_name' |
            translate }} *</label>
        </span>
        <anms-error [showError]="hasError('name',periodicServiceForm,submitted)" error="forms.feedback.required">
        </anms-error>
      </div>
    </div>
  </div>

  <div class="form-section form-section--inline mt-3">
    <div formArrayName="packages">
      <div class="row" [formGroupName]="i" *ngFor="let item of
        periodicServiceForm.get('packages')['controls'];let i= index">
        <div class="col-md-2 d-flex">
          <span class='plus-icon' (click)="addPackage()">
            <svg-icon src='assets/icons/add.svg' [svgStyle]="{ 'width.px':18 , 'fill': '#0DA06E' , 'height':
              '100%'}"></svg-icon>
          </span>
          <div class="title-wrapper">
            <h3 class="form-section__title">{{
              'configuration.periodic_service.package' | translate }}</h3>
          </div>
        </div>
        <div class="col-12 col-md-5 p-field form-section__field">
          <span class="p-float-label">
            <input formControlName="packageName" pInputText placeholder="{{ 'configuration.periodic_service.package_name' |
              translate }} *" required type="text">
            <label>{{ 'configuration.periodic_service.package_name' | translate
              }} *</label>
          </span>
          <div *ngIf="((packages.controls[i].get('packageName').dirty &&
            packages.controls[i].get('packageName').invalid) ||
            (packages.controls[i].get('packageName').invalid && submitted)) &&
            packages.controls[i].get('packageName').errors?.required" class="p-error">
            {{ 'forms.feedback.required' | translate }}
          </div>
        </div>
        <div class="col-12 col-md-5 p-field form-section__field
          dropdown-select-input">
          <p-dropdown inputId="unit" formControlName="intervalType" [options]="units" optionLabel="name"></p-dropdown>
          <div class="form-section__field w-100">
            <span class="p-float-label">
              <input formControlName="intervals" pInputText placeholder="{{ 'configuration.periodic_service.intervals' |
                translate }}" type="text">
              <label>{{ 'configuration.periodic_service.intervals' | translate
                }}</label>
            </span>
          </div>
        </div>
        <div class="col-12 col-md-2">
          <h3 class="form-section__title text-center">{{
            'configuration.periodic_service.task' | translate }}</h3>
        </div>
        <div class="col-12 col-md-5 p-field form-section__field" formArrayName="tasks">
          <div class="mt-2">
          <div class="mb-3 p-field form-section__field d-flex " *ngFor="let item of getPackageTasks(i).controls ;let j=index; let last=last;">
            <div class="input-group flex-with-button" [formGroupName]="j">
              <div class="autocomplete-select w-100">
                <span class="p-float-label">
                  <p-autoComplete formControlName="name" (completeMethod)="getAllTask($event)"
                                  [suggestions]="taskFiltered" field="name" [minLength]="1"
                                  [dropdown]="true"></p-autoComplete>
                                  <i class="pi pi-search"></i>
                                  <label>{{ 'configuration.periodic_service.task' | translate }} *</label>
                </span>
              </div>
              <anms-error [showError]="formArrayHasError(submitted, getTasksForm(i, j), j, 'name')" error="forms.feedback.required"></anms-error>

            </div>
            <span *ngIf="last" class="p-inputgroup-addon addon-primary" [ngStyle]="{'cursor': 'pointer','height': '40px'}"
                (click)="addTask('',i,j)">
                <i class="pi pi-plus"></i>
              </span>
            <span *ngIf="!last" class='remove-icon p-inputgroup-addon'(click)="removeTask(i,j)" [ngStyle]="{'cursor': 'pointer','height': '40px'}">
              <svg-icon src='assets/icons/add.svg'
                        [svgStyle]="{ 'width.px':18 , 'fill': '#F75A4A' , 'height': '100%', 'transform': 'rotate(45deg)'}"></svg-icon>
            </span>
          </div>
          </div>
        </div>

      </div>
    </div>


  </div>

</form>
<div class="row" *ngIf="false">
  <div class='col-12'>
    <div class='component_wrapper'>
      <div class='d-flex'>
        <app-table [setting]="tableSetting" [tableData]="periodicServices$"></app-table>
      </div>
    </div>
  </div>
</div>


<alert-dialog [settings]="dialogCancelSetting" [displayModal]="displayCancelModal" (confirm)="dialogConfirm($event)">
</alert-dialog>
<alert-dialog [settings]="dialogSuccessSetting" [displayModal]="displaySuccessModal" (confirm)="successDialogConfirm($event)"></alert-dialog>
<alert-dialog [settings]="dialogErrorSetting" [displayModal]="displayErrorModal"></alert-dialog>
